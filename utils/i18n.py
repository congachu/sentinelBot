from utils.db import get_lang

# 간단 키-문자열 사전
TEXTS = {
    "ko": {
        "setlog_ok": "✅ 로그 채널이 {channel} 으로 설정되었습니다.",
        "setlog_clear": "🧹 로그 채널 설정이 제거되었습니다.",
        "not_set": "⚠️ 로그 채널이 아직 설정되지 않았습니다. 먼저 `/setlog`를 실행하세요.",
        "testlog_title": "🔒 SentinelBot 로그 테스트",
        "testlog_body": "이 메시지가 보이면 로그 채널 설정 OK",
        "showconfig": "**로그 채널:** {channel}\n**언어(Language):** {lang}",
        "setlang_ok": "✅ 언어가 `{lang}`(으)로 설정되었습니다.",
        "unknown_error": "❌ 알 수 없는 오류가 발생했습니다.",
        "dm_join_notice": "🔒 보안 안내: 본 서버는 신규/의심 계정을 자동 모니터링합니다. 정상 유저라면 무시하셔도 됩니다. 문제가 있으면 관리자에게 알려주세요.",
        "log_join_title": "⚠️ 경고: 의심 입장 감지",
        "log_join_reason_new": "새 계정(≈{hours}h)",
        "log_join_reason_raid": "단시간 동시 입장 {count}명/{sec}s",
        "log_join_footer_config": "로그 채널은 /setlog 로 변경할 수 있습니다.",
        "log_spam_title": "🚨 스팸/남용 감지",
        "log_spam_footer_config": "스팸 정책은 차후 /spamset 으로 조정 예정",
        "dm_spam_notice": "🔒 안내: 서버의 스팸/남용 방지 정책에 의해 메시지가 제어되었습니다. 문제가 있으면 관리자에게 문의하세요.",
        "log_spam_reason_rate": "단시간 과도한 메시지 ({count} / 10s)",
        "log_spam_reason_everyone": "@everyone/@here 멘션 사용 차단",
        "log_spam_reason_mentions": "멘션 폭탄 (mentions={mentions}, limit={limit})",
        "log_spam_reason_link": "의심스러운 링크/도메인 차단",
        "policies_title": "🔧 현재 정책",
        "policies_body": (
            "**Risk**\n"
            "- 계정 최소 나이: {min_age}h\n- 레이드 판정: {raid_count}명/{raid_win}s\n\n"
            "**Spam**\n"
            "- 10초 최대 메시지: {max_msgs}\n- 메시지당 최대 멘션: {max_mentions}\n"
            "- @everyone/@here 차단: {block_eh}\n- 링크 필터: {link_filter}"
        ),
        "riskset_ok": "✅ Risk 정책이 업데이트되었습니다.",
        "spamset_ok": "✅ Spam 정책이 업데이트되었습니다.",
        "bool_on": "켜짐",
        "bool_off": "꺼짐",
        "panic_on": "🚨 패닉 모드가 활성화되었습니다. 모든 텍스트 채널을 읽기 전용으로 전환했습니다.",
        "panic_off": "✅ 패닉 모드가 해제되어 채널 권한을 원복했습니다.",
        "panic_already_on": "ℹ️ 이미 패닉 모드입니다.",
        "panic_already_off": "ℹ️ 패닉 모드가 아닙니다.",
        "panic_partial_warn": "⚠️ 일부 채널 권한 원복에 실패했습니다. 수동 확인이 필요할 수 있습니다.",

        "lockdown_on": "🛡️ 락다운이 활성화되었습니다. 신규/의심 계정의 메시지가 제한됩니다.",
        "lockdown_off": "✅ 락다운이 해제되었습니다.",
        "lockdown_already_on": "ℹ️ 이미 락다운 상태입니다.",
        "lockdown_already_off": "ℹ️ 락다운 상태가 아닙니다.",
        "lockdownset_ok": "✅ 락다운 임계값이 업데이트되었습니다.",
        "msg_blocked_lockdown": "🔒 안내: 현재 서버 락다운 상태로, 신규/의심 계정의 메시지는 제한됩니다.",
        "lockdown_title": "🔒 락다운",
        "lockdown_enabled": "상태: {state}",
        "lockdown_min_age": "계정 최소 나이: {hours}h",
        "lockdown_min_guild_age": "서버 합류 시간: {hours}h",
        "policy_update_delay": "⚠️ 정책 변경이 적용되기까지 최대 10초가 걸릴 수 있습니다.",
        "help_title": "📖 도움말",
        "help_intro": "원하는 기능의 슬래시 명령을 선택해 사용하세요. 특정 명령어 상세는 `/help command:<명령>`으로 확인할 수 있어요.",
        "help_cat_basic": "기본 설정",
        "help_cat_policies": "정책 관리",
        "help_cat_admin": "비상 제어",
        "help_cat_backup": "백업 / 복구",
        "help_tips_title": "사용 팁",
        "help_tips_body": "• 정책 변경 명령(`/riskset`, `/spamset`, `/lockdownset`)은 적용에 최대 10초가 걸릴 수 있어요.\n• 문제가 생기면 `/panic`으로 채팅을 일시 정지하고, 원복은 `/unpanic`을 사용하세요.\n• 서버 구조는 `/backup_create`로 백업하고 `/backup_restore`로 복구할 수 있어요.",
        "help_footer": "SentinelBot — 보안을 간단하게.",
        "help_unknown_command": "알 수 없는 명령어예요: {name}",
        "help_command_title": "명령어 정보: {name}",
        "help_command_desc": "설명:",
        "help_command_usage": "인자 설명:",
        "help_optional": "선택",
        "help_required": "필수",
        "help_examples_header": "예시:",
        "backup_start": "🗄️ 백업을 시작합니다. 서버 규모에 따라 시간이 걸릴 수 있어요.",
        "backup_done": "✅ 백업 완료! (ID: {id})",
        "backup_list_title": "🗂 백업 목록",
        "backup_list_empty": "목록이 비어있어요.",
        "backup_item": "• ID: {id} | {created} | {label}",
        "backup_not_found": "해당 백업(ID: {id})을 찾을 수 없어요.",
        "restore_start": "♻️ 복구를 시작합니다. 작업 중엔 채널/역할이 잠시 흔들릴 수 있어요.",
        "restore_done": "✅ 복구 완료!",
        "restore_warn": "⚠️ 일부 항목 복구에 실패했습니다. 로그를 확인해 주세요.",
        "delete_ok": "🧹 백업(ID: {id})을 삭제했어요.",
        "spamallow_hint": "사용법: `/spamallow add <역할>`, `/spamallow remove <역할>`, `/spamallow list`",
        "spamallow_added": "{role} 역할을 화이트리스트에 추가했어요.",
        "spamallow_removed": "{role} 역할을 화이트리스트에서 제거했어요.",
        "spamallow_list": "화이트리스트: {roles}",
        "none": "없음",   # 화이트리스트 비어있을 때
        "audit_score_title": "보안 점수",
        "audit_score_line": "{score} / 100",
        "audit_line_log_set": "로그 채널이 설정됨",
        "audit_line_log_missing": "로그 채널이 미설정 (먼저 /setlog 필요)",
        "audit_line_age_ok": "계정 최소 나이 정책 양호 (≥ 72h)",
        "audit_line_age_low": "계정 최소 나이 낮음 (현재 {hours}h)",
        "audit_line_raid_ok": "레이드 탐지 양호 (인원≥3, 윈도우≤60s)",
        "audit_line_raid_weak": "레이드 탐지 완화됨 (인원={count}, 윈도우={sec}s)",
        "audit_line_rate_ok": "스팸: 10초 메시지 제한 양호 (≤ {limit})",
        "audit_line_rate_bad": "스팸: 10초 메시지 제한 높음 (현재 {limit})",
        "audit_line_mentions_ok": "스팸: 메시지당 멘션 제한 양호 (≤ {limit})",
        "audit_line_mentions_bad": "스팸: 메시지당 멘션 제한 높음 (현재 {limit})",
        "audit_line_block_everyone_on": "@everyone/@here 차단 활성화",
        "audit_line_block_everyone_off": "@everyone/@here 차단 꺼짐",
        "audit_line_link_on": "링크 필터 활성화",
        "audit_line_link_off": "링크 필터 꺼짐",
        "audit_line_lockdown_on": "락다운 활성화 (상황 대응 설정)",
        "audit_line_lockdown_off_note": "락다운 비활성화 (평시 OFF 권장, 필요 시 /lockdown 활용)",
        "audit_line_backups_some": "백업 존재 (최소 1개)",
        "audit_line_backups_none": "백업 없음 (/backup_create 권장)",
        "audit_line_panic_off": "패닉 모드 OFF (정상)",
        "audit_line_panic_on": "패닉 모드 ON (해제 필요 시 /unpanic)",
        "audit_footer_hint": "정책 변경 후 적용까지 최대 10초가 걸릴 수 있어요.",
        "help_cat_audit": "보안 점검",
        "log_mod_title": "Moderation Action",
        "dm_mod_notice": "서버 정책 위반으로 {action} 조치되었습니다. 사유: {reason}",
        "auto_enforce_title": "자동 제재 규칙(요약)",
        "auto_enforce_rule_rate_link": "도배/피싱: 임계값 초과 후 30분 내 추가 10회 누적 → BAN",
        "auto_enforce_rule_everyone": "@everyone/@here: 2분 내 3회 → BAN (화이트리스트 역할 면제)",
        "auto_enforce_rule_join": "신규 계정(저연령) → KICK / 레이드 급증 → BAN",

        "help_auto_enforce_title": "자동 제재(자동 적용 규칙)",
        "log_ban_title": "🚫 사용자 차단(BAN)",
        "log_ban_by_label": "실행자",
        "log_ban_reason_label": "사유",
        "log_ban_by_bot": "봇(SentinelBot)",
        "log_ban_by_mod": "관리자 {mod}",
        "log_ban_by_unknown": "알 수 없음",
        "log_ban_no_reason": "사유 미기재",

        "log_unban_title": "✅ 차단 해제(UNBAN)",
        "log_unban_by_label": "실행자",
        "log_unban_reason_label": "사유",
        "log_unban_by_bot": "봇(SentinelBot)",
        "log_unban_by_mod": "관리자 {mod}",
        "log_unban_by_unknown": "알 수 없음",
        "log_unban_no_reason": "사유 미기재",
    },
    "en": {
        "setlog_ok": "✅ Log channel set to {channel}.",
        "setlog_clear": "🧹 Log channel setting has been cleared.",
        "not_set": "⚠️ Log channel is not set yet. Please run `/setlog` first.",
        "testlog_title": "🔒 SentinelBot Log Test",
        "testlog_body": "If you can see this, logging is configured correctly.",
        "showconfig": "**Log Channel:** {channel}\n**Language:** {lang}",
        "setlang_ok": "✅ Language set to `{lang}`.",
        "unknown_error": "❌ An unknown error occurred.",
        "dm_join_notice": "🔒 Security notice: This server automatically monitors new/suspicious accounts. If you are legit, you can ignore this message. Contact admins if you have issues.",
        "log_join_title": "⚠️ Warning: Suspicious Join Detected",
        "log_join_reason_new": "New account (≈{hours}h)",
        "log_join_reason_raid": "Join surge {count} users/{sec}s",
        "log_join_footer_config": "You can change the log channel with /setlog.",
        "log_spam_title": "🚨 Spam/Abuse Detected",
        "log_spam_footer_config": "Policy adjustable later via /spamset",
        "dm_spam_notice": "🔒 Notice: Your message was moderated by the server's anti-spam policy. Contact admins if this was a mistake.",
        "log_spam_reason_rate": "Excessive message rate ({count} / 10s)",
        "log_spam_reason_everyone": "Blocked @everyone/@here mention",
        "log_spam_reason_mentions": "Mention bomb (mentions={mentions}, limit={limit})",
        "log_spam_reason_link": "Suspicious link/domain blocked",
        "policies_title": "🔧 Current Policies",
        "policies_body": (
            "**Risk**\n"
            "- Min account age: {min_age}h\n- Raid detection: {raid_count} users/{raid_win}s\n\n"
            "**Spam**\n"
            "- Max msgs per 10s: {max_msgs}\n- Max mentions per msg: {max_mentions}\n"
            "- Block @everyone/@here: {block_eh}\n- Link filter: {link_filter}"
        ),
        "riskset_ok": "✅ Risk policy updated.",
        "spamset_ok": "✅ Spam policy updated.",
        "bool_on": "ON",
        "bool_off": "OFF",
        "panic_on": "🚨 Panic mode enabled. All text channels set to read-only.",
        "panic_off": "✅ Panic mode disabled. Permissions restored.",
        "panic_already_on": "ℹ️ Panic mode is already ON.",
        "panic_already_off": "ℹ️ Panic mode is not active.",
        "panic_partial_warn": "⚠️ Failed to restore some channels. Manual review may be required.",

        "lockdown_on": "🛡️ Lockdown enabled. Messages from new/suspicious accounts will be restricted.",
        "lockdown_off": "✅ Lockdown disabled.",
        "lockdown_already_on": "ℹ️ Lockdown is already ON.",
        "lockdown_already_off": "ℹ️ Lockdown is not active.",
        "lockdownset_ok": "✅ Lockdown thresholds updated.",
        "msg_blocked_lockdown": "🔒 Notice: During lockdown, messages from new/suspicious accounts are restricted.",
        "lockdown_title": "🔒 Lockdown",
        "lockdown_enabled": "Enabled: {state}",
        "lockdown_min_age": "Min account age: {hours}h",
        "lockdown_min_guild_age": "Min guild age: {hours}h",
        "policy_update_delay": "⚠️ Policy changes may take up to 10 seconds to apply.",
        "help_title": "📖 Help",
        "help_intro": "Use the slash commands below. For details of a specific command, run `/help command:<name>`.",
        "help_cat_basic": "Basic Setup",
        "help_cat_policies": "Policies",
        "help_cat_admin": "Emergency Controls",
        "help_cat_backup": "Backup / Restore",
        "help_tips_title": "Tips",
        "help_tips_body": "• Policy changes (`/riskset`, `/spamset`, `/lockdownset`) may take up to 10 seconds to apply.\n• If something goes wrong, use `/panic` to freeze chats, then `/unpanic` to restore.\n• Use `/backup_create` to snapshot and `/backup_restore` to recover your server structure.",
        "help_footer": "SentinelBot — Security made simple.",
        "help_unknown_command": "Unknown command: {name}",
        "help_command_title": "Command: {name}",
        "help_command_desc": "Description:",
        "help_command_usage": "Parameters:",
        "help_optional": "optional",
        "help_required": "required",
        "help_examples_header": "Examples:",
        "backup_start": "🗄️ Starting backup. This may take a while depending on server size.",
        "backup_done": "✅ Backup finished! (ID: {id})",
        "backup_list_title": "🗂 Backups",
        "backup_list_empty": "No backups found.",
        "backup_item": "• ID: {id} | {created} | {label}",
        "backup_not_found": "Backup not found (ID: {id}).",
        "restore_start": "♻️ Starting restore. Channels/Roles may change during the process.",
        "restore_done": "✅ Restore completed!",
        "restore_warn": "⚠️ Failed to restore some items. Please check logs.",
        "delete_ok": "🧹 Deleted backup (ID: {id}).",
        "spamallow_hint": "Usage: `/spamallow add <role>`, `/spamallow remove <role>`, `/spamallow list`",
        "spamallow_added": "Added {role} to the whitelist.",
        "spamallow_removed": "Removed {role} from the whitelist.",
        "spamallow_list": "Whitelist: {roles}",
        "none": "none",
        "audit_score_title": "Security Score",
        "audit_score_line": "{score} / 100",
        "audit_line_log_set": "Log channel is set",
        "audit_line_log_missing": "Log channel is not set (use /setlog first)",
        "audit_line_age_ok": "Risk: minimum account age is strong (≥ 72h)",
        "audit_line_age_low": "Risk: minimum account age is low (now {hours}h)",
        "audit_line_raid_ok": "Raid detection is strong (count≥3, window≤60s)",
        "audit_line_raid_weak": "Raid detection is lenient (count={count}, window={sec}s)",
        "audit_line_rate_ok": "Spam: rate limit OK (≤ {limit} per 10s)",
        "audit_line_rate_bad": "Spam: rate limit high (now {limit} per 10s)",
        "audit_line_mentions_ok": "Spam: mentions per message OK (≤ {limit})",
        "audit_line_mentions_bad": "Spam: mentions per message high (now {limit})",
        "audit_line_block_everyone_on": "Block @everyone/@here is ON",
        "audit_line_block_everyone_off": "Block @everyone/@here is OFF",
        "audit_line_link_on": "Link filter is ON",
        "audit_line_link_off": "Link filter is OFF",
        "audit_line_lockdown_on": "Lockdown is ON (incident response posture)",
        "audit_line_lockdown_off_note": "Lockdown is OFF (recommended in normal times; use /lockdown if needed)",
        "audit_line_backups_some": "Backups exist (≥ 1)",
        "audit_line_backups_none": "No backups (run /backup_create)",
        "audit_line_panic_off": "Panic mode OFF (normal)",
        "audit_line_panic_on": "Panic mode ON (use /unpanic to restore)",
        "audit_footer_hint": "Policy updates may take up to 10 seconds to propagate.",
        "help_cat_audit": "Security Audit",
        "log_mod_title": "Moderation Action",
        "dm_mod_notice": "You have been {action} due to a policy violation. Reason: {reason}",
        "auto_enforce_title": "Auto Enforcement (Summary)",
        "auto_enforce_rule_rate_link": "Rate/Phishing: after threshold breach, +10 more within 30 min → BAN",
        "auto_enforce_rule_everyone": "@everyone/@here: 3 times within 2 minutes → BAN (whitelisted roles exempt)",
        "auto_enforce_rule_join": "New (young) account → KICK / Raid surge → BAN",

        "help_auto_enforce_title": "Auto Enforcement (applied rules)",
        "log_ban_title": "🚫 Member Banned",
        "log_ban_by_label": "Executor",
        "log_ban_reason_label": "Reason",
        "log_ban_by_bot": "Bot (SentinelBot)",
        "log_ban_by_mod": "Moderator {mod}",
        "log_ban_by_unknown": "Unknown",
        "log_ban_no_reason": "No reason provided",

        "log_unban_title": "✅ Member Unbanned",
        "log_unban_by_label": "Executor",
        "log_unban_reason_label": "Reason",
        "log_unban_by_bot": "Bot (SentinelBot)",
        "log_unban_by_mod": "Moderator {mod}",
        "log_unban_by_unknown": "Unknown",
        "log_unban_no_reason": "No reason provided",
    },
}

def t(guild_id: int, key: str, **kwargs) -> str:
    lang = get_lang(guild_id)
    table = TEXTS.get(lang, TEXTS["ko"])
    msg = table.get(key, key)
    if kwargs:
        try:
            msg = msg.format(**kwargs)
        except Exception:
            pass
    return msg
